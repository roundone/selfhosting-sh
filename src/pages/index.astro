---
import BaseLayout from "../layouts/BaseLayout.astro";
import AppCard from "../components/AppCard.astro";
import { getCollection } from "astro:content";

const latestApps = (await getCollection("apps"))
  .sort(
    (a, b) =>
      b.data.datePublished.getTime() - a.data.datePublished.getTime()
  )
  .slice(0, 6);

const latestFoundations = (await getCollection("foundations"))
  .sort(
    (a, b) =>
      b.data.datePublished.getTime() - a.data.datePublished.getTime()
  )
  .slice(0, 3);

const categories = [
  { name: "Photo & Video", slug: "photo-management", emoji: "ğŸ“·" },
  { name: "File Sync & Storage", slug: "file-sync", emoji: "ğŸ“" },
  { name: "Media Servers", slug: "media-servers", emoji: "ğŸ¬" },
  { name: "Password Management", slug: "password-management", emoji: "ğŸ”" },
  { name: "Note Taking", slug: "note-taking", emoji: "ğŸ“" },
  { name: "Ad Blocking & DNS", slug: "ad-blocking", emoji: "ğŸ›¡ï¸" },
  { name: "VPN & Remote Access", slug: "vpn", emoji: "ğŸŒ" },
  { name: "Home Automation", slug: "home-automation", emoji: "ğŸ " },
  { name: "Monitoring", slug: "monitoring", emoji: "ğŸ“Š" },
  { name: "Automation", slug: "automation", emoji: "âš¡" },
  { name: "Docker Management", slug: "docker-management", emoji: "ğŸ³" },
  { name: "Backup", slug: "backup", emoji: "ğŸ’¾" },
];

const jsonLd = {
  "@context": "https://schema.org",
  "@type": "WebSite",
  name: "selfhosting.sh",
  url: "https://selfhosting.sh",
  description:
    "The definitive self-hosting resource. Every app, every guide, every comparison.",
};
---

<BaseLayout
  title="The Definitive Self-Hosting Resource"
  description="Replace your cloud subscriptions with stuff you run yourself. Every self-hosted app, every guide, every comparison."
  jsonLd={jsonLd}
>
  <!-- Hero -->
  <section class="text-center py-16 sm:py-24">
    <div class="flex items-center justify-center gap-3 mb-6">
      <span
        class="w-4 h-4 rounded-full bg-accent shadow-[0_0_12px_rgba(52,211,153,0.5)]"
      ></span>
      <span
        class="text-sm font-[family-name:var(--font-mono)] text-accent uppercase tracking-widest"
        >selfhosting.sh</span
      >
    </div>
    <h1
      class="text-4xl sm:text-5xl lg:text-6xl font-[family-name:var(--font-display)] font-extrabold leading-tight max-w-3xl mx-auto"
    >
      Replace your cloud subscriptions with stuff you run yourself
    </h1>
    <p class="mt-6 text-lg sm:text-xl text-secondary max-w-2xl mx-auto">
      Every self-hosted app. Every setup guide. Every comparison. Complete
      Docker Compose configs that just work.
    </p>
    <div class="mt-8 flex flex-wrap justify-center gap-4">
      <a
        href="/foundations/getting-started/"
        class="px-6 py-3 bg-accent text-deep font-bold rounded-lg hover:bg-accent/90 transition-colors"
      >
        Get Started
      </a>
      <a
        href="/apps/"
        class="px-6 py-3 border border-border text-primary rounded-lg hover:border-accent-dim hover:bg-surface transition-all"
      >
        Browse Apps
      </a>
    </div>
  </section>

  <!-- Categories -->
  <section class="mt-8">
    <h2
      class="text-2xl font-[family-name:var(--font-display)] font-bold mb-6"
    >
      Browse by Category
    </h2>
    <div class="grid gap-3 sm:grid-cols-2 lg:grid-cols-3">
      {
        categories.map((cat) => (
          <a
            href={`/categories/${cat.slug}/`}
            class="flex items-center gap-3 p-4 rounded-lg bg-surface border border-border hover:border-accent-dim hover:bg-elevated transition-all"
          >
            <span class="text-2xl">{cat.emoji}</span>
            <span class="font-[family-name:var(--font-display)] font-bold text-primary">
              {cat.name}
            </span>
          </a>
        ))
      }
    </div>
  </section>

  <!-- Latest App Guides -->
  {
    latestApps.length > 0 && (
      <section class="mt-16">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-2xl font-[family-name:var(--font-display)] font-bold">
            Latest App Guides
          </h2>
          <a
            href="/apps/"
            class="text-sm text-accent hover:underline"
          >
            View all â†’
          </a>
        </div>
        <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
          {latestApps.map((app) => (
            <AppCard entry={app} section="apps" />
          ))}
        </div>
      </section>
    )
  }

  <!-- Latest Foundations -->
  {
    latestFoundations.length > 0 && (
      <section class="mt-16">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-2xl font-[family-name:var(--font-display)] font-bold">
            Getting Started
          </h2>
          <a
            href="/foundations/"
            class="text-sm text-accent hover:underline"
          >
            View all â†’
          </a>
        </div>
        <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
          {latestFoundations.map((f) => (
            <AppCard entry={f} section="foundations" />
          ))}
        </div>
      </section>
    )
  }
</BaseLayout>

---
import BaseLayout from "../../layouts/BaseLayout.astro";
import AppCard from "../../components/AppCard.astro";
import { getCollection } from "astro:content";
import { getArticlesByCategory, getAllCategories } from "../../utils/collections";

export async function getStaticPaths() {
  const categories = await getAllCategories();
  return categories.map((category) => ({
    params: { category },
  }));
}

const { category } = Astro.params;
const { apps, comparisons, roundups, replaceGuides } =
  await getArticlesByCategory(category!);

const categoryLabel = category!
  .split("-")
  .map((w) => w.charAt(0).toUpperCase() + w.slice(1))
  .join(" ");
---

<BaseLayout
  title={`Self-Hosted ${categoryLabel}`}
  description={`Everything about self-hosted ${categoryLabel.toLowerCase()}: app guides, comparisons, and migration guides.`}
>
  <h1
    class="text-3xl sm:text-4xl font-[family-name:var(--font-display)] font-extrabold"
  >
    Self-Hosted {categoryLabel}
  </h1>
  <p class="mt-3 text-secondary text-lg mb-10">
    All guides, comparisons, and resources for {categoryLabel.toLowerCase()}.
  </p>

  {
    roundups.length > 0 && (
      <section class="mb-10">
        <h2 class="text-xl font-[family-name:var(--font-display)] font-bold mb-4">
          Best Of
        </h2>
        <div class="grid gap-4 sm:grid-cols-2">
          {roundups.map((r) => (
            <AppCard entry={r} section="roundups" />
          ))}
        </div>
      </section>
    )
  }

  {
    apps.length > 0 && (
      <section class="mb-10">
        <h2 class="text-xl font-[family-name:var(--font-display)] font-bold mb-4">
          App Guides
        </h2>
        <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
          {apps.map((a) => (
            <AppCard entry={a} section="apps" />
          ))}
        </div>
      </section>
    )
  }

  {
    comparisons.length > 0 && (
      <section class="mb-10">
        <h2 class="text-xl font-[family-name:var(--font-display)] font-bold mb-4">
          Comparisons
        </h2>
        <div class="grid gap-4 sm:grid-cols-2">
          {comparisons.map((c) => (
            <AppCard entry={c} section="comparisons" />
          ))}
        </div>
      </section>
    )
  }

  {
    replaceGuides.length > 0 && (
      <section class="mb-10">
        <h2 class="text-xl font-[family-name:var(--font-display)] font-bold mb-4">
          Replace Cloud Services
        </h2>
        <div class="grid gap-4 sm:grid-cols-2">
          {replaceGuides.map((r) => (
            <AppCard entry={r} section="replace" />
          ))}
        </div>
      </section>
    )
  }
</BaseLayout>
